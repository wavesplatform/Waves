package com.wavesplatform.http

import akka.http.scaladsl.model._
import akka.http.scaladsl.server.Route
import com.wavesplatform.account.{AddressScheme, KeyPair, PublicKey}
import com.wavesplatform.api.common.CommonTransactionsApi
import com.wavesplatform.api.common.CommonTransactionsApi.TransactionMeta
import com.wavesplatform.api.http.ApiError._
import com.wavesplatform.api.http.ApiMarshallers._
import com.wavesplatform.api.http.TransactionsApiRoute
import com.wavesplatform.block.Block
import com.wavesplatform.block.Block.TransactionProof
import com.wavesplatform.common.state.ByteStr
import com.wavesplatform.common.utils.{Base58, _}
import com.wavesplatform.db.WithDomain
import com.wavesplatform.features.{BlockchainFeatures => BF}
import com.wavesplatform.history.{Domain, settingsWithFeatures}
import com.wavesplatform.lang.directives.values.StdLibVersion.V5
import com.wavesplatform.lang.script.Script
import com.wavesplatform.lang.v1.FunctionHeader
import com.wavesplatform.lang.v1.compiler.Terms.{CONST_BOOLEAN, CONST_LONG, CONST_STRING, FUNCTION_CALL}
import com.wavesplatform.lang.v1.compiler.TestCompiler
import com.wavesplatform.lang.v1.traits.domain.LeaseCancel
import com.wavesplatform.network.TransactionPublisher
import com.wavesplatform.state.reader.LeaseDetails
import com.wavesplatform.state.{Blockchain, Height, InvokeScriptResult}
import com.wavesplatform.test._
import com.wavesplatform.transaction.Asset.IssuedAsset
import com.wavesplatform.transaction.TxValidationError.GenericError
import com.wavesplatform.transaction.lease.{LeaseCancelTransaction, LeaseTransaction}
import com.wavesplatform.transaction.smart.InvokeScriptTransaction.Payment
import com.wavesplatform.transaction.smart.script.trace.{AccountVerifierTrace, TracedResult}
import com.wavesplatform.transaction.smart.{InvokeScriptTransaction, SetScriptTransaction}
import com.wavesplatform.transaction.transfer.{MassTransferTransaction, TransferTransaction}
import com.wavesplatform.transaction.{Asset, CreateAliasTransaction, GenesisTransaction, Proofs, TxHelpers, TxVersion}
import com.wavesplatform.{BlockGen, TestTime, TestValues, TestWallet}
import monix.reactive.Observable
import org.scalacheck.Gen._
import org.scalacheck.{Arbitrary, Gen}
import org.scalamock.scalatest.MockFactory
import org.scalatest.OptionValues
import play.api.libs.json.Json.JsValueWrapper
import play.api.libs.json._

import scala.concurrent.Future
import scala.util.Random

class TransactionsRouteSpec
    extends RouteSpec("/transactions")
    with RestAPISettingsHelper
    with MockFactory
    with BlockGen
    with OptionValues
    with TestWallet
    with WithDomain {

  private val blockchain          = mock[Blockchain]
  private val utxPoolSynchronizer = mock[TransactionPublisher]
  private val addressTransactions = mock[CommonTransactionsApi]
  private val utxPoolSize         = mockFunction[Int]
  private val testTime            = new TestTime

  private val transactionsApiRoute = new TransactionsApiRoute(
    restAPISettings,
    addressTransactions,
    testWallet,
    blockchain,
    utxPoolSize,
    utxPoolSynchronizer,
    testTime
  )

  private val route = seal(transactionsApiRoute.route)

  private val invalidBase58Gen = alphaNumStr.map(_ + "0")

  routePath("/calculateFee") - {
    "transfer with Waves fee" - {
      val transferTxScenario =
        for {
          sender    <- accountGen
          recipient <- accountGen
          version   <- Gen.oneOf(TransferTransaction.supportedVersions.toSeq)
          tx = Json.obj(
            "type"            -> 4,
            "version"         -> version,
            "amount"          -> 1000000,
            "senderPublicKey" -> sender.publicKey.toString,
            "recipient"       -> recipient.toAddress
          )
        } yield (sender.publicKey, tx)
      "TransferTransaction" in forAll(transferTxScenario) {
        case (_, transferTx) =>
          (addressTransactions.calculateFee _).expects(*).returning(Right((Asset.Waves, 100000L, 0L))).once()

          Post(routePath("/calculateFee"), transferTx) ~> route ~> check {
            status shouldEqual StatusCodes.OK
            (responseAs[JsObject] \ "feeAssetId").asOpt[String] shouldBe empty
            (responseAs[JsObject] \ "feeAmount").as[Long] shouldEqual 100000
          }
      }

      val massTransferTxScenario =
        for {
          sender     <- accountGen
          recipient1 <- accountGen
          recipient2 <- accountGen
          version    <- Gen.oneOf(MassTransferTransaction.supportedVersions.toSeq)
          tx = Json.obj(
            "type"            -> 11,
            "version"         -> version,
            "senderPublicKey" -> Base58.encode(sender.publicKey.arr),
            "transfers" -> Json.arr(
              Json.obj(
                "recipient" -> recipient1.toAddress,
                "amount"    -> 1000000
              ),
              Json.obj(
                "recipient" -> recipient2.toAddress,
                "amount"    -> 2000000
              )
            )
          )
        } yield (sender.publicKey, tx)
      "MassTransferTransaction" in forAll(massTransferTxScenario) {
        case (_, transferTx) =>
          (addressTransactions.calculateFee _).expects(*).returning(Right((Asset.Waves, 200000L, 0L))).once()

          Post(routePath("/calculateFee"), transferTx) ~> route ~> check {
            status shouldEqual StatusCodes.OK
            (responseAs[JsObject] \ "feeAssetId").asOpt[String] shouldBe empty
            (responseAs[JsObject] \ "feeAmount").as[Long] shouldEqual 200000
          }
      }
    }

    "transfer with Asset fee" - {
      val transferTxWithAssetFeeScenario =
        for {
          assetId   <- issueGen.map(_.assetId)
          sender    <- accountGen
          recipient <- accountGen
          version   <- Gen.oneOf(TransferTransaction.supportedVersions.toSeq)
          tx = Json.obj(
            "type"            -> 4,
            "version"         -> version,
            "amount"          -> 1000000,
            "feeAssetId"      -> assetId.toString,
            "senderPublicKey" -> Base58.encode(sender.publicKey.arr),
            "recipient"       -> recipient.toAddress
          )
        } yield (sender.publicKey, tx, IssuedAsset(assetId))
      "without sponsorship" in forAll(transferTxWithAssetFeeScenario) {
        case (_, transferTx, _) =>
          (addressTransactions.calculateFee _).expects(*).returning(Right((Asset.Waves, 100000L, 0L))).once()

          Post(routePath("/calculateFee"), transferTx) ~> route ~> check {
            status shouldEqual StatusCodes.OK
            (responseAs[JsObject] \ "feeAssetId").asOpt[String] shouldBe empty
            (responseAs[JsObject] \ "feeAmount").as[Long] shouldEqual 100000
          }
      }

      "with sponsorship" in {
        val assetId: IssuedAsset = IssuedAsset(issueGen.sample.get.assetId)
        val sender: PublicKey    = accountGen.sample.get.publicKey
        val transferTx = Json.obj(
          "type"            -> 4,
          "version"         -> 2,
          "amount"          -> 1000000,
          "feeAssetId"      -> assetId.id.toString,
          "senderPublicKey" -> Base58.encode(sender.arr),
          "recipient"       -> accountGen.sample.get.toAddress
        )

        (addressTransactions.calculateFee _).expects(*).returning(Right((assetId, 5L, 0L))).once()

        Post(routePath("/calculateFee"), transferTx) ~> route ~> check {
          status shouldEqual StatusCodes.OK
          (responseAs[JsObject] \ "feeAssetId").as[String] shouldBe assetId.id.toString
          (responseAs[JsObject] \ "feeAmount").as[Long] shouldEqual 5
        }
      }

      "with sponsorship, smart token and smart account" in {
        val assetId: IssuedAsset = IssuedAsset(issueGen.sample.get.assetId)
        val sender: PublicKey    = accountGen.sample.get.publicKey
        val transferTx = Json.obj(
          "type"            -> 4,
          "version"         -> 2,
          "amount"          -> 1000000,
          "feeAssetId"      -> assetId.id.toString,
          "senderPublicKey" -> Base58.encode(sender.arr),
          "recipient"       -> accountGen.sample.get.toAddress
        )

        (addressTransactions.calculateFee _).expects(*).returning(Right((assetId, 45L, 0L))).once()

        Post(routePath("/calculateFee"), transferTx) ~> route ~> check {
          status shouldEqual StatusCodes.OK
          (responseAs[JsObject] \ "feeAssetId").as[String] shouldBe assetId.id.toString
          (responseAs[JsObject] \ "feeAmount").as[Long] shouldEqual 45
        }
      }

      s"after ${BF.SynchronousCalls}" in withDomain(
        settingsWithFeatures(
          BF.SmartAccounts,
          BF.SmartAssets,
          BF.Ride4DApps,
          BF.FeeSponsorship,
          BF.DataTransaction,
          BF.BlockReward,
          BF.BlockV5,
          BF.SynchronousCalls
        )
      ) { d =>
        val defaultSigner    = testWallet.generateNewAccount().get
        val secondSigner     = testWallet.generateNewAccount().get
        val thirdSigner      = testWallet.generateNewAccount().get
        val defaultRecipient = testWallet.generateNewAccount().get

        val route = mkRoute(d)

        d.appendBlock(
          GenesisTransaction.create(defaultSigner.toAddress, 10.waves, ntpTime.getTimestamp()).explicitGet(),
          GenesisTransaction.create(secondSigner.toAddress, 10.waves, ntpTime.getTimestamp()).explicitGet(),
          GenesisTransaction.create(thirdSigner.toAddress, 10.waves, ntpTime.getTimestamp()).explicitGet(),
          SetScriptTransaction
            .selfSigned(
              2.toByte,
              defaultSigner,
              Some(TestCompiler(V5).compileExpression("""{-# STDLIB_VERSION 5 #-}
                |{-# CONTENT_TYPE EXPRESSION #-}
                |{-# SCRIPT_TYPE ACCOUNT #-}
                |
                |sigVerify_16Kb(tx.bodyBytes, tx.proofs[0], tx.senderPublicKey)
                |""".stripMargin)),
              0.01.waves,
              ntpTime.getTimestamp()
            )
            .explicitGet(),
          SetScriptTransaction
            .selfSigned(
              2.toByte,
              secondSigner,
              Some(TestCompiler(V5).compileExpression("""{-# STDLIB_VERSION 5 #-}
                |{-# CONTENT_TYPE EXPRESSION #-}
                |{-# SCRIPT_TYPE ACCOUNT #-}
                |
                |match tx {
                |  case t: Order | SetScriptTransaction => false
                |  case _ =>
                |    let s0 = if (sigVerify(tx.bodyBytes, tx.proofs[0], tx.senderPublicKey)) then 1 else 0
                |    let s1 = if (sigVerify(tx.bodyBytes, tx.proofs[1], tx.senderPublicKey)) then 1 else 0
                |    let s2 = if (sigVerify(tx.bodyBytes, tx.proofs[2], tx.senderPublicKey)) then 1 else 0
                |    s0 + s1 + s2 > 1
                |}
                |""".stripMargin)),
              0.01.waves,
              ntpTime.getTimestamp()
            )
            .explicitGet()
        )

        Post(
          routePath("/calculateFee"),
          Json.obj(
            "type"            -> 4,
            "version"         -> 2,
            "amount"          -> 1,
            "senderPublicKey" -> defaultSigner.publicKey,
            "recipient"       -> defaultRecipient.toAddress
          )
        ) ~> route ~> check {
          status shouldEqual StatusCodes.OK
          d.blockchain.accountScript(defaultSigner.toAddress).get.verifierComplexity should be < 200L
          (responseAs[JsObject] \ "feeAmount").as[Long] shouldEqual 100000
        }

        Post(
          routePath("/calculateFee"),
          Json.obj(
            "type"            -> 4,
            "version"         -> 2,
            "amount"          -> 1,
            "senderPublicKey" -> secondSigner.publicKey,
            "recipient"       -> defaultRecipient.toAddress
          )
        ) ~> route ~> check {
          status shouldEqual StatusCodes.OK
          d.blockchain.accountScript(secondSigner.toAddress).get.verifierComplexity should be > 200L
          (responseAs[JsObject] \ "feeAmount").as[Long] shouldEqual 500000
        }

        Post(
          routePath("/calculateFee"),
          Json.obj(
            "type"            -> 4,
            "version"         -> 2,
            "amount"          -> 1,
            "senderPublicKey" -> thirdSigner.publicKey,
            "recipient"       -> accountGen.sample.get.toAddress
          )
        ) ~> route ~> check {
          status shouldEqual StatusCodes.OK
          (responseAs[JsObject] \ "feeAmount").as[Long] shouldEqual 100000
        }
      }
    }

    "invoke with issued assets" in withDomain(settingsWithFeatures(BF.BlockV5, BF.Ride4DApps, BF.SynchronousCalls)) { d =>
      val dAppSigner  = testWallet.generateNewAccount().get
      val dAppAddress = dAppSigner.toAddress
      val invokeScript = InvokeScriptTransaction
        .selfSigned(2.toByte, dAppSigner, dAppAddress, None, Seq.empty, 0.005.waves, Asset.Waves, ntpTime.getTimestamp())
        .explicitGet()

      d.appendBlock(
        GenesisTransaction.create(dAppAddress, 10.waves, ntpTime.getTimestamp()).explicitGet(),
        SetScriptTransaction
          .selfSigned(
            2.toByte,
            dAppSigner,
            Some(TestCompiler(V5).compileContract("""{-# STDLIB_VERSION 5 #-}
            |{-# SCRIPT_TYPE ACCOUNT #-}
            |{-# CONTENT_TYPE DAPP #-}
            |
            |@Callable(i)
            |func default() = {
            |  [
            |    Issue("name", "description", 1000, 4, true, unit, 0),
            |    Issue("name", "description", 1000, 4, true, unit, 1)
            |  ]
            |}
            |""".stripMargin)),
            0.01.waves,
            ntpTime.getTimestamp()
          )
          .explicitGet()
      )

      Post(routePath("/calculateFee"), invokeScript.json()) ~> mkRoute(d) ~> check {
        responseAs[JsObject] should matchJson(
          Json.obj(
            "feeAssetId" -> JsNull,
            "feeAmount"  -> 200500000
          )
        )
      }
    }

    "invoke with verifier" - {
      "with complexity <= 200" in {


      }
      "with complexity > 200" in withDomain(settingsWithFeatures(BF.BlockV5, BF.Ride4DApps, BF.SynchronousCalls)) { d =>
        val dappAccount = testWallet.generateNewAccount().get
        val sender      = testWallet.generateNewAccount().get

        val invoke = InvokeScriptTransaction
          .selfSigned(2.toByte, sender, dappAccount.toAddress, Some(FUNCTION_CALL(FunctionHeader.User("finishDuckHatching"), List(CONST_STRING("FGbMBkFBw7pHdeiWM3YExxFFGSQ8zLJSZEuwoZezxNpa").explicitGet()))), Seq.empty, 0.009.waves, Asset.Waves, ntpTime.getTimestamp())
          .explicitGet()

        d.appendBlock(
          GenesisTransaction.create(dappAccount.toAddress, 20.waves, ntpTime.getTimestamp()).explicitGet(),
          GenesisTransaction.create(sender.toAddress, 20.waves, ntpTime.getTimestamp()).explicitGet()
        )

        d.appendBlock(
          SetScriptTransaction
            .selfSigned(
              2.toByte,
              sender,
              Some(Script.fromBase64String("base64:AAIFAAAAAAAAC/4IAhIECgIIARIDCgEEEgASABIAEgMKAQgSAwoBCBIDCgEIEgMKAQgSBAoCCAgSAwoBCBIFCgMIAQESABoOCgJhMRIIbUFjY1BLZXkaDgoCYTISCG1BY2NBZGRyGhAKAmEzEgpmZWVQZXJjZW50GhMKAmE0Eg1vbGRFZ2dBc3NldElkGhgKAmE1EhJzd2FwRWdnRGFwcEFkZHJlc3MaFQoCYTYSD2tUb3RhbExpcXVpZGl0eRoSCgJhNxIMa0luaXRpYWxpemVkGhkKAmE4EhNrTGlxdWlkaXR5VGhyZXNob2xkGhcKAmE5EhFrRmFybVBhcnRpY2lwYW50cxoXCgJiMRIRa1RvdGFsU2hhcmVUb2tlbnMaEwoCYjISDWtTaGFyZUFzc2V0SWQaEgoCYjMSDGtGYXJtaW5nRGFwcBoWCgJiNBIQa01hcmtldFByb3h5RGFwcBoNCgJiNRIHa0xvY2tlZBoZCgJiNhITa1RvdGFsRmFybWluZ1Jld2FyZBoWCgJiNxIQa0Nlb0NvbGxlY3RlZEZlZRodCgJiOBIXa0Nlb0NvbGxlY3RlZEZlZU92ZXJhbGwaDgoCYjkSCGtUb0Rpc3RyGhUKAmMxEg9rVW5zdGFrZWRSZXdhcmQaGAoCYzISEmtMb2NrZWRJbnZlc3RtZW50cxoMCgJjMxIGZ2V0SW50GgkKAmM0EgNrZXkaDQoCYzUSByRtYXRjaDAaBwoCYzYSAWIaDAoCYzcSBmdldFN0choNCgJjOBIHZ2V0Qm9vbBoNCgJjORIHZ2V0U3RyQRoHCgJkMRIBYRoHCgJkMhIBaxoYCgJkMxISZ2V0TWFya2V0UHJveHlBZGRyGg4KAmQ0EghnZXRFZ2dJZBoVCgJkNRIPZ2V0U2hhcmVBc3NldElkGgcKAmQ2EgFpGgoKAmQ3EgRuYW1lGhYKAmQ4EhBtaW5pbXVtVGhyZXNob2xkGhEKAmQ5EgtzaGFyZVRva2VucxoQCgJlMRIKc2hhcmVUb2tlbhoHCgJlMhIBcxoQCgJlMxIKZWdnQXNzZXRJZBoUCgJlNBIOdG90YWxMaXF1aWRpdHkaFgoCZTUSEHRvdGFsU2hhcmVUb2tlbnMaHAoCZTYSFmN1cnJlbnRMaXF1aWRpdHlBbW91bnQaFwoCZTcSEXNoYXJlVG9rZW5zVG9HaXZlGhMKAmU4Eg1zaGFyZVRva2Vuc0lkGg0KAmU5EgdyZWlzc3VlGhYKAmYxEhBmYXJtUGFydGljaXBhbnRzGhMKAmYyEg1rUGFydGljaXBhdGVkGhkKAmYzEhNhbHJlYWR5UGFydGljaXBhdGVkGhkKAmY0EhNuZXdGYXJtUGFydGljaXBhbnRzGgkKAmY1EgNpZHMaEQoCZjYSC2Zhcm1pbmdEYXBwGhEKAmY3EgtjbGFpbVJld2FyZBoLCgJmOBIFYWNjdW0aCwoCZjkSBW5mdElkGgwKAmcxEgZpbnZSZXMaCQoCZzISA2ludBoMCgJnMxIGbmZ0SWRzGhAKAmc0Egpmb2xkUmVzdWx0GhMKAmc1Eg0kbGlzdDU3NDY1Nzc4GhMKAmc2Eg0kc2l6ZTU3NDY1Nzc4GhMKAmc3Eg0kYWNjMDU3NDY1Nzc4GhMKAmc4Eg0kYWNjMTU3NDY1Nzc4GhMKAmc5Eg0kYWNjMjU3NDY1Nzc4GhMKAmgxEg0kYWNjMzU3NDY1Nzc4GhMKAmgyEg0kYWNjNDU3NDY1Nzc4GhMKAmgzEg0kYWNjNTU3NDY1Nzc4GhMKAmg0Eg0kYWNjNjU3NDY1Nzc4GhMKAmg1Eg0kYWNjNzU3NDY1Nzc4GhMKAmg2Eg0kYWNjODU3NDY1Nzc4GhMKAmg3Eg0kYWNjOTU3NDY1Nzc4GhQKAmg4Eg4kYWNjMTA1NzQ2NTc3OBoUCgJoORIOJGFjYzExNTc0NjU3NzgaEwoCaTESDWNsYWltZWRSZXdhcmQaFAoCaTISDmZhcm1DZW9GZWVTaXplGg0KAmkzEgd0b0Rpc3RyGhgKAmk0EhJ0b3RhbEZhcm1pbmdSZXdhcmQaEwoCaTUSDWN1cnJlbnRDZW9GZWUaEwoCaTYSDWNlb0ZlZU92ZXJhbGwaDQoCaTcSB2FkZHJlc3MaHAoCaTgSFmN1cnJlbnRDZW9Db2xsZWN0ZWRGZWUaDwoCaTkSCWF1Y3Rpb25JZBoOCgJqMRIIZnVuY3Rpb24aDQoCajISB2Fzc2V0SWQaGAoCajMSEmZhcm1pbmdEYXBwQWRkcmVzcxoTCgJqNBINdXN0YWtlZFJld2FyZBoXCgJqNRIRdW5zdGFrZWRSZXdhcmROb3caFwoCajYSEW5ld1Vuc3Rha2VkUmV3YXJkGgoKAmo3EgR0eElkGggKAmo4EgJ0eBoPCgJqORIJa1JldmVydGVkGhAKAmsxEgp0eFJldmVydGVkGhAKAmsyEgptaW5CYWxhbmNlGhcKAmszEhFjdXJyZW50RWdnQmFsYW5jZRoPCgJrNBIJYWRkcmVzc2VzGh0KAms1Ehd0b3RhbFJld2FyZFRvRGlzdHJpYnV0ZRoSCgJrNhIMYWRkcmVzc1BhaXJzGhQKAms3Eg5wcm9jZXNzQWRkcmVzcxoRCgJrOBILYWRkcmVzc1BhaXIaEgoCazkSDGFkZHJlc3NQYXJ0cxoQCgJsMRIKYWRkcmVzc1N0choVCgJsMhIPdXNlclNoYXJlVG9rZW5zGhEKAmwzEgtrQWRkckVhcm5lZBoVCgJsNBIPYWRkclRvdGFsRWFybmVkGhMKAmw1Eg11c2VyUmV3YXJkTm93GgkKAmw2EgNyZXMaDAoCbDcSBnJlc3VsdBoVCgJsOBIPJGxpc3QxMDUwNzEwNTU0GhUKAmw5Eg8kc2l6ZTEwNTA3MTA1NTQaFQoCbTESDyRhY2MwMTA1MDcxMDU1NBoVCgJtMhIPJGFjYzExMDUwNzEwNTU0GhUKAm0zEg8kYWNjMjEwNTA3MTA1NTQaFQoCbTQSDyRhY2MzMTA1MDcxMDU1NBoVCgJtNRIPJGFjYzQxMDUwNzEwNTU0GhUKAm02Eg8kYWNjNTEwNTA3MTA1NTQaFQoCbTcSDyRhY2M2MTA1MDcxMDU1NBoVCgJtOBIPJGFjYzcxMDUwNzEwNTU0GhUKAm05Eg8kYWNjODEwNTA3MTA1NTQaFQoCbjESDyRhY2M5MTA1MDcxMDU1NBoWCgJuMhIQJGFjYzEwMTA1MDcxMDU1NBoWCgJuMxIQJGFjYzExMTA1MDcxMDU1NBoWCgJuNBIQJGFjYzEyMTA1MDcxMDU1NBoWCgJuNRIQJGFjYzEzMTA1MDcxMDU1NBoWCgJuNhIQJGFjYzE0MTA1MDcxMDU1NBoWCgJuNxIQJGFjYzE1MTA1MDcxMDU1NBoWCgJuOBIQJGFjYzE2MTA1MDcxMDU1NBoWCgJuORIQJGFjYzE3MTA1MDcxMDU1NBoWCgJvMRIQJGFjYzE4MTA1MDcxMDU1NBoWCgJvMhIQJGFjYzE5MTA1MDcxMDU1NBoWCgJvMxIQJGFjYzIwMTA1MDcxMDU1NBoWCgJvNBIQJGFjYzIxMTA1MDcxMDU1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BQAAAAJsOQAAAAAAAAAACQUAAAACbjEEAAAAAm4yCQEAAAACazcAAAACBQAAAAJuMQkAAZEAAAACBQAAAAJsOAAAAAAAAAAACQMJAAAAAAAAAgUAAAACbDkAAAAAAAAAAAoFAAAAAm4yBAAAAAJuMwkBAAAAAms3AAAAAgUAAAACbjIJAAGRAAAAAgUAAAACbDgAAAAAAAAAAAoDCQAAAAAAAAIFAAAAAmw5AAAAAAAAAAALBQAAAAJuMwQAAAACbjQJAQAAAAJrNwAAAAIFAAAAAm4zCQABkQAAAAIFAAAAAmw4AAAAAAAAAAALAwkAAAAAAAACBQAAAAJsOQAAAAAAAAAADAUAAAACbjQEAAAAAm41CQEAAAACazcAAAACBQAAAAJuNAkAAZEAAAACBQAAAAJsOAAAAAAAAAAADAMJAAAAAAAAAgUAAAACbDkAAAAAAAAAAA0FAAAAAm41BAAAAAJuNgkBAAAAAms3AAAAAgUAAAACbjUJAAGRAAAAAgUAAAACbDgAAAAAAAAAAA0DCQAAAAAAAAIFAAAAAmw5AAAAAAAAAAAOBQAAAAJuNgQAAAACbjcJAQAAAAJrNwAAAAIFAAAAAm42CQABkQAAAAIFAAAAAmw4AAAAAAAAAAAOAwkAAAAAAAACBQAAAAJsOQAAAAAAAAAADwUAAAACbjcEAAAAAm44CQEAAAACazcAAAACBQAAAAJuNwkAAZEAAAACBQAAAAJsOAAAAAAAAAAADwMJAAAAAAAAAgUAAAACbDkAAAAAAAAAABAFAAAAAm44BAAAAAJuOQkBAAAAAms3AAAAAgUAAAACbjgJAAGRAAAAAgUAAAACbDgAAAAAAAAAABADCQAAAAAAAAIFAAAAAmw5AAAAAAAAAAARBQAAAAJuOQQAAAACbzEJAQAAAAJrNwAAAAIFAAAAAm45CQABkQAAAAIFAAAAAmw4AAAAAAAAAAARAwkAAAAAAAACBQAAAAJsOQAAAAAAAAAAEgUAAAACbzEEAAAAAm8yCQEAAAACazcAAAACBQAAAAJvMQkAAZEAAAACBQAAAAJsOAAAAAAAAAAAEgMJAAAAAAAAAgUAAAACbDkAAAAAAAAAABMFAAAAAm8yBAAAAAJvMwkBAAAAAms3AAAAAgUAAAACbzIJAAGRAAAAAgUAAAACbDgAAAAAAAAAABMDCQAAAAAA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").explicitGet()),
              0.01.waves,
              ntpTime.getTimestamp()
            )
            .explicitGet(),
          SetScriptTransaction
            .selfSigned(
              2.toByte,
              dappAccount,
              Some(Script.fromBase64String("base64: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MDYwMTI2MDQzAAAAAAAAAAAAAwkAAAAAAAACBQAAAA0kc2l6ZTYwMTI2MDQzAAAAAAAAAAAABQAAAA0kYWNjMDYwMTI2MDQzBAAAAA0kYWNjMTYwMTI2MDQzCQEAAAAJaXNTeW1ib2xHAAAAAgUAAAANJGFjYzA2MDEyNjA0MwkAAZEAAAACBQAAAA0kbGlzdDYwMTI2MDQzAAAAAAAAAAAAAwkAAAAAAAACBQAAAA0kc2l6ZTYwMTI2MDQzAAAAAAAAAAABBQAAAA0kYWNjMTYwMTI2MDQzBAAAAA0kYWNjMjYwMTI2MDQzCQEAAAAJaXNTeW1ib2xHAAAAAgUAAAANJGFjYzE2MDEyNjA0MwkAAZEAAAACBQAAAA0kbGlzdDYwMTI2MDQzAAAAAAAAAAABAwkAAAAAAAACBQAAAA0kc2l6ZTYwMTI2MDQzAAAAAAAAAAACBQAAAA0kYWNjMjYwMTI2MDQzBAAAAA0kYWNjMzYwMTI2MDQzCQEAAAAJaXNTeW1ib2xHAAAAAgUAAAANJGFjYzI2MDEyNjA0MwkAAZEAAAACBQAAAA0kbGlzdDYwMTI2MDQzAAAAAAAAAAACAwkAAAAAAAACBQAAAA0kc2l6ZTYwMTI2MDQzAAAAAAAAAAADBQAAAA0kYWNjMzYwMTI2MDQzBAAAAA0kYWNjNDYwMTI2MDQzCQEAAAAJaXNTeW1ib2xHAAAAAgUAAAANJGFjYzM2MDEyNjA0MwkAAZEAAAACBQAAAA0kbGlzdDYwMTI2MDQzAAAAAAAAAAADAwkAAAAAAAACBQAAAA0kc2l6ZTYwMTI2MDQzAAAAAAAAAAAEBQAAAA0kYWNjNDYwMTI2MDQzBAAAAA0kYWNjNTYwMTI2MDQzCQEAAAAJaXNTeW1ib2xHAAAAAgUAAAANJGFjYzQ2MDEyNjA0MwkAAZEAAAACBQAAAA0kbGlzdDYwMTI2MDQzAAAAAAAAAAAEAwkAAAAAAAACBQAAAA0kc2l6ZTYwMTI2MDQzAAAAAAAAAAAFBQAAAA0kYWNjNTYwMTI2MDQzBAAAAA0kYWNjNjYwMTI2MDQzCQEAAAAJaXNTeW1ib2xHAAAAAgUAAAANJGFjYzU2MDEyNjA0MwkAAZEAAAACBQAAAA0kbGlzdDYwMTI2MDQzAAAAAAAAAAAFAwkAAAAAAAACBQAAAA0kc2l6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AAANc2Vjb25kQXNzZXRJZAMJAQAAAAIhPQAAAAIFAAAADWJyZWVkZWRTdGF0dXMCAAAABHRydWUJAAACAAAAAQkAASwAAAACAgAAAB9UaGVzZSBkdWNrcyBjYW5ub3QgYmUgYnJlZWRlZDogBQAAAA1icmVlZGVkU3RhdHVzCQAETAAAAAIJAQAAAAtTdHJpbmdFbnRyeQAAAAIJAQAAABBnZXREdWNrUGFyZW50S2V5AAAAAggFAAAAAWkAAAANdHJhbnNhY3Rpb25JZAAAAAAAAAAAAQUAAAAMZmlyc3RBc3NldElkCQAETAAAAAIJAQAAAAtTdHJpbmdFbnRyeQAAAAIJAQAAABBnZXREdWNrUGFyZW50S2V5AAAAAggFAAAAAWkAAAANdHJhbnNhY3Rpb25JZAAAAAAAAAAAAgUAAAANc2Vjb25kQXNzZXRJZAkABEwAAAACCQEAAAALU3RyaW5nRW50cnkAAAACCQEAAAATZ2V0UHJvY2Vzc1N0YXR1c0tleQAAAAIJAAQlAAAAAQgFAAAAAWkAAAAGY2FsbGVyCAUAAAABaQAAAA10cmFuc2FjdGlvbklkBQAAAA9IYXRjaGluZ1N0YXJ0ZWQJAARMAAAAAgkBAAAADEludGVnZXJFbnRyeQAAAAIJAQAAABlnZXRQcm9jZXNzRmluaXNoSGVpZ2h0S2V5AAAAAgkABCUAAAABCAUAAAABaQAAAAZjYWxsZXIIBQAAAAFpAAAADXRyYW5zYWN0aW9uSWQJAABkAAAAAgUAAAAGaGVpZ2h0BQAAABBkZWxheUZvckhhdGNoaW5nBQAAAANuaWwAAAABaQEAAAASZmluaXNoRHVja0hhdGNoaW5nAAAAAQAAAAd0eElkU3RyBAAAAAR0eElkCQACWQAAAAEFAAAAB3R4SWRTdHIEAAAAEHByb2Nlc3NTdGF0dXNLZXkJAQAAABNnZXRQcm9jZXNzU3RhdHVzS2V5AAAAAgkABCUAAAABCAUAAAABaQAAAAZjYWxsZXIFAAAABHR4SWQEAAAAD2ZpbmlzaEhlaWdodEtleQkBAAAAGWdldFByb2Nlc3NGaW5pc2hIZWlnaHRLZXkAAAACCQAEJQAAAAEIBQAAAAFpAAAABmNhbGxlcgUAAAAEdHhJZAQAAAAJZHVja0lkS2V5CQEAAAAMZ2V0RHVja0lk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").explicitGet()),
              0.01.waves,
              ntpTime.getTimestamp()
            )
            .explicitGet()
        )

        d.blockchain.accountScript(sender.toAddress).get.verifierComplexity should be > 200L

        Post(
          routePath("/calculateFee"),
          HttpEntity(ContentTypes.`application/json`, invoke.json().toString())
        ) ~> mkRoute(d) ~> check {
//          (responseAs[JsObject] \ "feeAmount").as[Long] shouldEqual 0.009.waves
        }

        d.appendBlock(invoke)

        d.blockchain.transactionInfo(invoke.id()).get._3 shouldBe true
      }
    }
  }

  private def mkRoute(d: Domain): Route =
    seal(
      new TransactionsApiRoute(
        restAPISettings,
        d.commonApi.transactions,
        testWallet,
        d.blockchain,
        () => 0,
        (t, _) => d.commonApi.transactions.broadcastTransaction(t),
        ntpTime
      ).route
    )

  "returns lease details for lease cancel transaction" in withDomain(settingsWithFeatures(BF.SmartAccounts)) { d =>
    val sender      = testWallet.generateNewAccount().get
    val recipient   = testWallet.generateNewAccount().get
    val lease       = LeaseTransaction.selfSigned(2.toByte, sender, recipient.toAddress, 5.waves, 0.001.waves, ntpTime.getTimestamp()).explicitGet()
    val leaseCancel = LeaseCancelTransaction.selfSigned(2.toByte, sender, lease.id(), 0.001.waves, ntpTime.getTimestamp()).explicitGet()
    val sealedRoute = mkRoute(d)

    d.appendBlock(
      GenesisTransaction.create(sender.toAddress, 10.waves, ntpTime.getTimestamp()).explicitGet(),
      GenesisTransaction.create(recipient.toAddress, 10.waves, ntpTime.getTimestamp()).explicitGet(),
      lease
    )

    def expectedJson(status: String, cancelHeight: Option[Int] = None, cancelTransactionId: Option[ByteStr] = None): JsObject =
      Json.parse(s"""{
         |  "type" : 9,
         |  "id" : "${leaseCancel.id()}",
         |  "sender" : "${sender.toAddress}",
         |  "senderPublicKey" : "${sender.publicKey}",
         |  "fee" : ${0.001.waves},
         |  "feeAssetId" : null,
         |  "timestamp" : ${leaseCancel.timestamp},
         |  "proofs" : [ "${leaseCancel.signature}" ],
         |  "version" : 2,
         |  "leaseId" : "${lease.id()}",
         |  "chainId" : 84,
         |  "lease" : {
         |    "id" : "${lease.id()}",
         |    "originTransactionId" : "${lease.id()}",
         |    "sender" : "${sender.toAddress}",
         |    "recipient" : "${recipient.toAddress}",
         |    "amount" : ${5.waves},
         |    "height" : 1,
         |    "status" : "$status",
         |    "cancelHeight" : ${cancelHeight.getOrElse("null")},
         |    "cancelTransactionId" : ${cancelTransactionId.fold("null")(id => s"\"$id\"")}
         |  }
         |}""".stripMargin).as[JsObject]

    d.utxPool.putIfNew(leaseCancel)

    withClue(routePath("/unconfirmed")) {
      Get(routePath(s"/unconfirmed")) ~> sealedRoute ~> check {
        responseAs[Seq[JsObject]].head should matchJson(expectedJson("active"))
      }
    }

    d.appendBlock(leaseCancel)

    val cancelTransactionJson = expectedJson("canceled", Some(2), Some(leaseCancel.id())) ++ Json.obj("height" -> 2)

    withClue(routePath("/address/{address}/limit/{limit}")) {
      Get(routePath(s"/address/${recipient.toAddress}/limit/10")) ~> sealedRoute ~> check {
        val json = (responseAs[JsArray] \ 0 \ 0).as[JsObject]
        json should matchJson(cancelTransactionJson)
      }
    }

    withClue(routePath("/info/{id}")) {
      Get(routePath(s"/info/${leaseCancel.id()}")) ~> sealedRoute ~> check {
        responseAs[JsObject] should matchJson(cancelTransactionJson)
      }
    }
  }

  routePath("/address/{address}/limit/{limit}") - {
    val bytes32StrGen = bytes32gen.map(Base58.encode)
    val addressGen    = accountGen.map(_.toAddress.toString)

    "handles parameter errors with corresponding responses" - {
      "invalid address" in {
        forAll(bytes32StrGen) { badAddress =>
          Get(routePath(s"/address/$badAddress/limit/1")) ~> route should produce(InvalidAddress)
        }
      }

      "invalid limit" - {
        "limit is too big" in {
          forAll(addressGen, choose(MaxTransactionsPerRequest + 1, Int.MaxValue).label("limitExceeded")) {
            case (address, limit) =>
              Get(routePath(s"/address/$address/limit/$limit")) ~> route should produce(TooBigArrayAllocation)
          }
        }
      }

      "invalid after" in {
        forAll(addressGen, choose(1, MaxTransactionsPerRequest).label("limitCorrect"), invalidBase58Gen) {
          case (address, limit, invalidBase58) =>
            Get(routePath(s"/address/$address/limit/$limit?after=$invalidBase58")) ~> route ~> check {
              status shouldEqual StatusCodes.BadRequest
              (responseAs[JsObject] \ "message").as[String] shouldEqual s"Unable to decode transaction id $invalidBase58"
            }
        }
      }
    }

    "returns 200 if correct params provided" - {
      "address and limit" in {
        forAll(addressGen, choose(1, MaxTransactionsPerRequest).label("limitCorrect")) {
          case (address, limit) =>
            (addressTransactions.aliasesOfAddress _).expects(*).returning(Observable.empty).once()
            (addressTransactions.transactionsByAddress _).expects(*, *, *, None).returning(Observable.empty).once()
            Get(routePath(s"/address/$address/limit/$limit")) ~> route ~> check {
              status shouldEqual StatusCodes.OK
            }
        }
      }

      "address, limit and after" in {
        forAll(addressGen, choose(1, MaxTransactionsPerRequest).label("limitCorrect"), bytes32StrGen) {
          case (address, limit, txId) =>
            (addressTransactions.aliasesOfAddress _).expects(*).returning(Observable.empty).once()
            (addressTransactions.transactionsByAddress _).expects(*, *, *, *).returning(Observable.empty).once()
            Get(routePath(s"/address/$address/limit/$limit?after=$txId")) ~> route ~> check {
              status shouldEqual StatusCodes.OK
            }
        }
      }
    }

    "provides stateChanges" in forAll(accountGen) { account =>
      val transaction = TxHelpers.invoke(account.toAddress, "test")

      (() => blockchain.activatedFeatures).expects().returns(Map.empty).anyNumberOfTimes()
      (addressTransactions.aliasesOfAddress _).expects(*).returning(Observable.empty).once()
      (addressTransactions.transactionsByAddress _)
        .expects(account.toAddress, *, *, None)
        .returning(Observable(TransactionMeta.Invoke(Height(1), transaction, succeeded = true, Some(InvokeScriptResult()))))
        .once()

      Get(routePath(s"/address/${account.toAddress}/limit/1")) ~> route ~> check {
        status shouldEqual StatusCodes.OK
        (responseAs[JsArray] \ 0 \ 0 \ "stateChanges").as[JsObject] shouldBe Json.toJsObject(InvokeScriptResult())
      }
    }

    "provides lease and lease cancel actions stateChanges" in {
      val invokeAddress    = accountGen.sample.get.toAddress
      val leaseId1         = ByteStr(bytes32gen.sample.get)
      val leaseId2         = ByteStr(bytes32gen.sample.get)
      val leaseCancelId    = ByteStr(bytes32gen.sample.get)
      val recipientAddress = accountGen.sample.get.toAddress
      val recipientAlias   = aliasGen.sample.get
      val invoke           = TxHelpers.invoke(invokeAddress, "test")
      val scriptResult = InvokeScriptResult(
        leases = Seq(InvokeScriptResult.Lease(recipientAddress, 100, 1, leaseId1), InvokeScriptResult.Lease(recipientAlias, 200, 3, leaseId2)),
        leaseCancels = Seq(LeaseCancel(leaseCancelId))
      )

      (blockchain.leaseDetails _)
        .expects(leaseId1)
        .returning(Some(LeaseDetails(TestValues.keyPair.publicKey, TestValues.address, 123, LeaseDetails.Status.Active, leaseId1, 1)))
        .anyNumberOfTimes()
      (blockchain.leaseDetails _)
        .expects(leaseId2)
        .returning(Some(LeaseDetails(TestValues.keyPair.publicKey, TestValues.address, 123, LeaseDetails.Status.Active, leaseId2, 1)))
        .anyNumberOfTimes()
      (blockchain.leaseDetails _)
        .expects(leaseCancelId)
        .returning(
          Some(
            LeaseDetails(
              TestValues.keyPair.publicKey,
              TestValues.address,
              123,
              LeaseDetails.Status.Cancelled(2, Some(leaseCancelId)),
              leaseCancelId,
              1
            )
          )
        )
        .anyNumberOfTimes()
      (blockchain.transactionMeta _).expects(leaseId1).returning(Some((1, true))).anyNumberOfTimes()
      (blockchain.transactionMeta _).expects(leaseId2).returning(Some((1, true))).anyNumberOfTimes()
      (blockchain.transactionMeta _).expects(leaseCancelId).returning(Some((1, true))).anyNumberOfTimes()

      (() => blockchain.activatedFeatures).expects().returning(Map.empty).anyNumberOfTimes()
      (addressTransactions.aliasesOfAddress _).expects(*).returning(Observable.empty).once()
      (addressTransactions.transactionsByAddress _)
        .expects(invokeAddress, *, *, None)
        .returning(Observable(TransactionMeta.Invoke(Height(1), invoke, succeeded = true, Some(scriptResult))))
        .once()

      Get(routePath(s"/address/${invokeAddress}/limit/1")) ~> route ~> check {
        status shouldEqual StatusCodes.OK
        val json = (responseAs[JsArray] \ 0 \ 0 \ "stateChanges").as[JsObject]
        json should matchJson(s"""{
                                    |  "data": [],
                                    |  "transfers": [],
                                    |  "issues": [],
                                    |  "reissues": [],
                                    |  "burns": [],
                                    |  "sponsorFees": [],
                                    |  "leases": [
                                    |    {
                                    |      "id": "$leaseId1",
                                    |      "originTransactionId": "$leaseId1",
                                    |      "sender": "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                    |      "recipient": "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                    |      "amount": 123,
                                    |      "height": 1,
                                    |      "status":"active",
                                    |      "cancelHeight" : null,
                                    |      "cancelTransactionId" : null
                                    |    },
                                    |    {
                                    |      "id": "$leaseId2",
                                    |      "originTransactionId": "$leaseId2",
                                    |      "sender": "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                    |      "recipient": "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                    |      "amount": 123,
                                    |      "height": 1,
                                    |      "status":"active",
                                    |      "cancelHeight" : null,
                                    |      "cancelTransactionId" : null
                                    |    }
                                    |  ],
                                    |  "leaseCancels": [
                                    |    {
                                    |      "id": "$leaseCancelId",
                                    |      "originTransactionId": "$leaseCancelId",
                                    |      "sender": "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                    |      "recipient": "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                    |      "amount": 123,
                                    |      "height": 1,
                                    |      "status":"canceled",
                                    |      "cancelHeight" : 2,
                                    |      "cancelTransactionId" : "$leaseCancelId"
                                    |    }
                                    |  ],
                                    |  "invokes": []
                                    |}""".stripMargin)
      }
    }
  }

  routePath("/info/{id}") - {
    "handles invalid signature" in {
      forAll(invalidBase58Gen) { invalidBase58 =>
        Get(routePath(s"/info/$invalidBase58")) ~> route should produce(InvalidTransactionId("Wrong char"), matchMsg = true)
      }

      Get(routePath(s"/info/")) ~> route should produce(InvalidTransactionId("Transaction ID was not specified"))
      Get(routePath(s"/info")) ~> route should produce(InvalidTransactionId("Transaction ID was not specified"))
    }

    "working properly otherwise" in {
      val txAvailability = for {
        tx                           <- randomTransactionGen
        height                       <- posNum[Int]
        acceptFailedActivationHeight <- posNum[Int]
        succeed                      <- if (height >= acceptFailedActivationHeight) Arbitrary.arbBool.arbitrary else Gen.const(true)
      } yield (tx, succeed, height, acceptFailedActivationHeight)

      forAll(txAvailability) {
        case (tx, succeed, height, acceptFailedActivationHeight) =>
          (addressTransactions.transactionById _).expects(tx.id()).returning(Some(TransactionMeta.Default(Height(height), tx, succeed))).once()
          (() => blockchain.activatedFeatures)
            .expects()
            .returning(Map(BF.BlockV5.id -> acceptFailedActivationHeight))
            .anyNumberOfTimes()

          def validateResponse(): Unit = {
            status shouldEqual StatusCodes.OK

            val extraFields =
              if (blockchain.isFeatureActivated(BF.BlockV5, height))
                Json.obj("height"    -> height, "applicationStatus" -> JsString(if (succeed) "succeeded" else "script_execution_failed"))
              else Json.obj("height" -> height)
            responseAs[JsValue] shouldEqual (tx.json() ++ extraFields)
          }

          Get(routePath(s"/info/${tx.id().toString}")) ~> route ~> check(validateResponse())
      }
    }

    "provides stateChanges" in forAll(accountGen) { account =>
      val transaction = TxHelpers.invoke(account.toAddress, "test")

      (() => blockchain.activatedFeatures).expects().returns(Map.empty).anyNumberOfTimes()
      (addressTransactions.transactionById _)
        .expects(transaction.id())
        .returning(Some(TransactionMeta.Invoke(Height(1), transaction, succeeded = true, Some(InvokeScriptResult()))))
        .once()

      Get(routePath(s"/info/${transaction.id()}")) ~> route ~> check {
        status shouldEqual StatusCodes.OK
        (responseAs[JsObject] \ "stateChanges").as[JsObject] shouldBe Json.toJsObject(InvokeScriptResult())
      }
    }

    "provides lease and lease cancel action stateChanges" in {
      val invokeAddress    = accountGen.sample.get.toAddress
      val recipientAddress = accountGen.sample.get.toAddress
      val recipientAlias   = aliasGen.sample.get

      val leaseId1      = ByteStr(bytes32gen.sample.get)
      val leaseId2      = ByteStr(bytes32gen.sample.get)
      val leaseCancelId = ByteStr(bytes32gen.sample.get)

      val nestedInvokeAddress = accountGen.sample.get.toAddress
      val nestedLeaseId       = ByteStr(bytes32gen.sample.get)
      val nestedLeaseCancelId = ByteStr(bytes32gen.sample.get)

      val invoke = TxHelpers.invoke(invokeAddress, "test")
      val scriptResult = InvokeScriptResult(
        leases = Seq(InvokeScriptResult.Lease(recipientAddress, 100, 1, leaseId1), InvokeScriptResult.Lease(recipientAlias, 200, 3, leaseId2)),
        leaseCancels = Seq(LeaseCancel(leaseCancelId)),
        invokes = Seq(
          InvokeScriptResult.Invocation(
            nestedInvokeAddress,
            InvokeScriptResult.Call("nested", Nil),
            Nil,
            InvokeScriptResult(
              leases = Seq(InvokeScriptResult.Lease(recipientAddress, 100, 1, nestedLeaseId)),
              leaseCancels = Seq(LeaseCancel(nestedLeaseCancelId))
            )
          )
        )
      )

      (blockchain.leaseDetails _)
        .expects(leaseId1)
        .returning(Some(LeaseDetails(TestValues.keyPair.publicKey, TestValues.address, 123, LeaseDetails.Status.Active, leaseId1, 1)))
        .anyNumberOfTimes()
      (blockchain.leaseDetails _)
        .expects(leaseId2)
        .returning(Some(LeaseDetails(TestValues.keyPair.publicKey, TestValues.address, 123, LeaseDetails.Status.Active, leaseId2, 1)))
        .anyNumberOfTimes()
      (blockchain.leaseDetails _)
        .expects(leaseCancelId)
        .returning(
          Some(
            LeaseDetails(
              TestValues.keyPair.publicKey,
              TestValues.address,
              123,
              LeaseDetails.Status.Cancelled(2, Some(leaseCancelId)),
              leaseCancelId,
              1
            )
          )
        )
        .anyNumberOfTimes()
      (blockchain.leaseDetails _)
        .expects(nestedLeaseId)
        .returning(Some(LeaseDetails(TestValues.keyPair.publicKey, TestValues.address, 123, LeaseDetails.Status.Active, nestedLeaseId, 1)))
        .anyNumberOfTimes()
      (blockchain.leaseDetails _)
        .expects(nestedLeaseCancelId)
        .returning(
          Some(
            LeaseDetails(
              TestValues.keyPair.publicKey,
              TestValues.address,
              123,
              LeaseDetails.Status.Cancelled(2, Some(nestedLeaseCancelId)),
              nestedLeaseCancelId,
              1
            )
          )
        )
        .anyNumberOfTimes()

      (blockchain.transactionMeta _).expects(leaseId1).returning(Some((1, true))).anyNumberOfTimes()
      (blockchain.transactionMeta _).expects(leaseId2).returning(Some((1, true))).anyNumberOfTimes()
      (blockchain.transactionMeta _).expects(leaseCancelId).returning(Some((1, true))).anyNumberOfTimes()
      (blockchain.transactionMeta _).expects(nestedLeaseId).returning(Some((1, true))).anyNumberOfTimes()
      (blockchain.transactionMeta _).expects(nestedLeaseCancelId).returning(Some((1, true))).anyNumberOfTimes()

      (() => blockchain.activatedFeatures).expects().returns(Map.empty).anyNumberOfTimes()
      (addressTransactions.transactionById _)
        .expects(invoke.id())
        .returning(Some(TransactionMeta.Invoke(Height(1), invoke, succeeded = true, Some(scriptResult))))
        .once()

      Get(routePath(s"/info/${invoke.id()}")) ~> route ~> check {
        status shouldEqual StatusCodes.OK
        val json = (responseAs[JsObject] \ "stateChanges").as[JsObject]
        json should matchJson(s"""{
                                   |  "data" : [ ],
                                   |  "transfers" : [ ],
                                   |  "issues" : [ ],
                                   |  "reissues" : [ ],
                                   |  "burns" : [ ],
                                   |  "sponsorFees" : [ ],
                                   |  "leases" : [ {
                                   |    "id" : "$leaseId1",
                                   |    "originTransactionId" : "$leaseId1",
                                   |    "sender" : "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                   |    "recipient" : "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                   |    "amount" : 123,
                                   |    "height" : 1,
                                   |    "status":"active",
                                   |    "cancelHeight" : null,
                                   |    "cancelTransactionId" : null
                                   |  }, {
                                   |    "id" : "$leaseId2",
                                   |    "originTransactionId" : "$leaseId2",
                                   |    "sender" : "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                   |    "recipient" : "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                   |    "amount" : 123,
                                   |    "height" : 1,
                                   |    "status":"active",
                                   |    "cancelHeight" : null,
                                   |    "cancelTransactionId" : null
                                   |  } ],
                                   |  "leaseCancels" : [ {
                                   |    "id" : "$leaseCancelId",
                                   |    "originTransactionId" : "$leaseCancelId",
                                   |    "sender" : "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                   |    "recipient" : "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                   |    "amount" : 123,
                                   |    "height" : 1,
                                   |    "status" : "canceled",
                                   |    "cancelHeight" : 2,
                                   |    "cancelTransactionId" : "$leaseCancelId"
                                   |  } ],
                                   |  "invokes" : [ {
                                   |    "dApp" : "$nestedInvokeAddress",
                                   |    "call" : {
                                   |      "function" : "nested",
                                   |      "args" : [ ]
                                   |    },
                                   |    "payment" : [ ],
                                   |    "stateChanges" : {
                                   |      "data" : [ ],
                                   |      "transfers" : [ ],
                                   |      "issues" : [ ],
                                   |      "reissues" : [ ],
                                   |      "burns" : [ ],
                                   |      "sponsorFees" : [ ],
                                   |      "leases" : [ {
                                   |        "id" : "$nestedLeaseId",
                                   |        "originTransactionId" : "$nestedLeaseId",
                                   |        "sender" : "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                   |        "recipient" : "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                   |        "amount" : 123,
                                   |        "height" : 1,
                                   |        "status":"active",
                                   |        "cancelHeight" : null,
                                   |        "cancelTransactionId" : null
                                   |      } ],
                                   |      "leaseCancels" : [ {
                                   |        "id" : "$nestedLeaseCancelId",
                                   |        "originTransactionId" : "$nestedLeaseCancelId",
                                   |        "sender" : "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                   |        "recipient" : "3MtGzgmNa5fMjGCcPi5nqMTdtZkfojyWHL9",
                                   |        "amount" : 123,
                                   |        "height" : 1,
                                   |        "status" : "canceled",
                                   |        "cancelHeight" : 2,
                                   |        "cancelTransactionId" : "$nestedLeaseCancelId"
                                   |      } ],
                                   |      "invokes" : [ ]
                                   |    }
                                   |  } ]
                                   |}
                                   |""".stripMargin)
      }
    }

    "handles multiple ids" in {
      val txCount = 5
      val txs     = (1 to txCount).map(_ => TxHelpers.invoke(TxHelpers.defaultSigner.toAddress, "test"))
      txs.foreach(
        tx =>
          (addressTransactions.transactionById _)
            .expects(tx.id())
            .returns(Some(TransactionMeta.Invoke(Height(1), tx, succeeded = true, Some(InvokeScriptResult()))))
            .repeat(3)
      )

      (() => blockchain.activatedFeatures).expects().returns(Map(BF.BlockV5.id -> 1)).anyNumberOfTimes()

      def checkResponse(): Unit = txs.zip(responseAs[JsArray].value) foreach {
        case (tx, json) =>
          val extraFields = Json.obj("height" -> 1, "applicationStatus" -> "succeeded", "stateChanges" -> InvokeScriptResult())
          json shouldBe (tx.json() ++ extraFields)
      }

      Get(routePath(s"/info?${txs.map("id=" + _.id()).mkString("&")}")) ~> route ~> check(checkResponse())
      Post(routePath("/info"), FormData(txs.map("id" -> _.id().toString): _*)) ~> route ~> check(checkResponse())
      Post(
        routePath("/info"),
        HttpEntity(ContentTypes.`application/json`, Json.obj("ids" -> Json.arr(txs.map(_.id().toString: JsValueWrapper): _*)).toString())
      ) ~> route ~> check(
        checkResponse()
      )
    }
  }

  routePath("/status/{signature}") - {
    "handles invalid signature" in {
      forAll(invalidBase58Gen) { invalidBase58 =>
        Get(routePath(s"/status?id=$invalidBase58")) ~> route should produce(InvalidIds(Seq(invalidBase58)))
      }
    }

    "handles empty request" in {
      Get(routePath(s"/status?")) ~> route should produce(CustomValidationError("Empty request"))
    }

    "working properly otherwise" in {
      val txAvailability = for {
        tx                           <- randomTransactionGen
        height                       <- Gen.chooseNum(1, 1000)
        acceptFailedActivationHeight <- Gen.chooseNum(1, 1000)
        succeed                      <- if (height >= acceptFailedActivationHeight) Arbitrary.arbBool.arbitrary else Gen.const(true)
      } yield (tx, height, acceptFailedActivationHeight, succeed)

      forAll(txAvailability) {
        case (tx, height, acceptFailedActivationHeight, succeed) =>
          (blockchain.transactionInfo _).expects(tx.id()).returning(Some((height, tx, succeed))).anyNumberOfTimes()
          (() => blockchain.height).expects().returning(1000).anyNumberOfTimes()
          (() => blockchain.activatedFeatures)
            .expects()
            .returning(Map(BF.BlockV5.id -> acceptFailedActivationHeight))
            .anyNumberOfTimes()

          Get(routePath(s"/status?id=${tx.id().toString}&id=${tx.id().toString}")) ~> route ~> check {
            status shouldEqual StatusCodes.OK
            val obj = {
              val common = Json.obj(
                "id"            -> tx.id().toString,
                "status"        -> "confirmed",
                "height"        -> JsNumber(height),
                "confirmations" -> JsNumber(1000 - height)
              )
              val applicationStatus =
                if (blockchain.isFeatureActivated(BF.BlockV5, height))
                  Json.obj("applicationStatus" -> JsString(if (succeed) "succeeded" else "script_execution_failed"))
                else Json.obj()
              common ++ applicationStatus
            }
            responseAs[JsValue] shouldEqual Json.arr(obj, obj)
          }
          Post(routePath("/status"), Json.obj("ids" -> Seq(tx.id().toString, tx.id().toString))) ~> route ~> check {
            status shouldEqual StatusCodes.OK
          }
      }
    }
  }

  routePath("/unconfirmed") - {
    "returns the list of unconfirmed transactions" in {
      val g = for {
        i <- chooseNum(0, 20)
        t <- listOfN(i, randomTransactionGen)
      } yield t

      forAll(g) { txs =>
        (() => addressTransactions.unconfirmedTransactions).expects().returning(txs).once()
        Get(routePath("/unconfirmed")) ~> route ~> check {
          val resp = responseAs[Seq[JsValue]]
          for ((r, t) <- resp.zip(txs)) {
            if ((r \ "version").as[Int] == 1) {
              (r \ "signature").as[String] shouldEqual t.proofs.proofs.head.toString
            } else {
              (r \ "proofs").as[Seq[String]] shouldEqual t.proofs.proofs.map(_.toString)
            }
          }
        }
      }
    }
  }

  routePath("/unconfirmed/size") - {
    "returns the size of unconfirmed transactions" in {
      val g = for {
        i <- chooseNum(0, 20)
        t <- listOfN(i, randomTransactionGen)
      } yield t

      forAll(g) { txs =>
        utxPoolSize.expects().returning(txs.size).once()
        Get(routePath("/unconfirmed/size")) ~> route ~> check {
          status shouldEqual StatusCodes.OK
          responseAs[JsValue] shouldEqual Json.obj("size" -> JsNumber(txs.size))
        }
      }
    }
  }

  routePath("/unconfirmed/info/{id}") - {
    "handles invalid signature" in {
      forAll(invalidBase58Gen) { invalidBase58 =>
        Get(routePath(s"/unconfirmed/info/$invalidBase58")) ~> route should produce(InvalidTransactionId("Wrong char"), matchMsg = true)
      }

      Get(routePath(s"/unconfirmed/info/")) ~> route should produce(InvalidSignature)
      Get(routePath(s"/unconfirmed/info")) ~> route should produce(InvalidSignature)
    }

    "working properly otherwise" in {
      forAll(randomTransactionGen) { tx =>
        (addressTransactions.unconfirmedTransactionById _).expects(tx.id()).returns(Some(tx)).once()
        Get(routePath(s"/unconfirmed/info/${tx.id().toString}")) ~> route ~> check {
          status shouldEqual StatusCodes.OK
          responseAs[JsValue] shouldEqual tx.json()
        }
      }
    }
  }

  routePath("/sign") - {
    "function call without args" in {
      val acc1 = testWallet.generateNewAccount().get
      val acc2 = testWallet.generateNewAccount().get

      val funcName          = "func"
      val funcWithoutArgs   = Json.obj("function" -> funcName)
      val funcWithEmptyArgs = Json.obj("function" -> funcName, "args" -> JsArray.empty)
      val funcWithArgs = InvokeScriptTransaction.serializer.functionCallToJson(
        FUNCTION_CALL(
          FunctionHeader.User(funcName),
          List(CONST_LONG(1), CONST_BOOLEAN(true))
        )
      )

      def invoke(func: JsObject, expectedArgsLength: Int): Unit = {
        val ist = Json.obj(
          "type"       -> InvokeScriptTransaction.typeId,
          "version"    -> Gen.oneOf(InvokeScriptTransaction.supportedVersions.toSeq).sample.get,
          "sender"     -> acc1.toAddress,
          "dApp"       -> acc2.toAddress,
          "call"       -> func,
          "payment"    -> Seq[Payment](),
          "fee"        -> 500000,
          "feeAssetId" -> JsNull
        )
        Post(routePath("/sign"), ist) ~> ApiKeyHeader ~> route ~> check {
          status shouldEqual StatusCodes.OK
          val jsObject = responseAs[JsObject]
          (jsObject \ "senderPublicKey").as[String] shouldBe acc1.publicKey.toString
          (jsObject \ "call" \ "function").as[String] shouldBe funcName
          (jsObject \ "call" \ "args").as[JsArray].value.length shouldBe expectedArgsLength
        }
      }

      invoke(funcWithoutArgs, 0)
      invoke(funcWithEmptyArgs, 0)
      invoke(funcWithArgs, 2)
    }
  }

  routePath("/broadcast") - {
    def withInvokeScriptTransaction(f: (KeyPair, InvokeScriptTransaction) => Unit): Unit = {
      val seed = new Array[Byte](32)
      Random.nextBytes(seed)
      val sender: KeyPair = KeyPair(seed)
      val ist = InvokeScriptTransaction(
        TxVersion.V1,
        sender.publicKey,
        sender.toAddress,
        None,
        Seq.empty,
        500000L,
        Asset.Waves,
        testTime.getTimestamp(),
        Proofs.empty,
        AddressScheme.current.chainId
      ).signWith(sender.privateKey)
      f(sender, ist)
    }

    "shows trace when trace is enabled" in withInvokeScriptTransaction { (sender, ist) =>
      val accountTrace = AccountVerifierTrace(sender.toAddress, Some(GenericError("Error in account script")))
      (utxPoolSynchronizer.validateAndBroadcast _)
        .expects(*, None)
        .returning(
          Future.successful(TracedResult(Right(true), List(accountTrace)))
        )
        .once()
      Post(routePath("/broadcast?trace=true"), ist.json()) ~> route ~> check {
        val result = responseAs[JsObject]
        (result \ "trace").as[JsValue] shouldBe Json.arr(accountTrace.json)
      }
    }

    "does not show trace when trace is disabled" in withInvokeScriptTransaction { (sender, ist) =>
      val accountTrace = AccountVerifierTrace(sender.toAddress, Some(GenericError("Error in account script")))
      (utxPoolSynchronizer.validateAndBroadcast _)
        .expects(*, None)
        .returning(
          Future.successful(TracedResult(Right(true), List(accountTrace)))
        )
        .twice()
      Post(routePath("/broadcast"), ist.json()) ~> route ~> check {
        (responseAs[JsObject] \ "trace") shouldBe empty
      }
      Post(routePath("/broadcast?trace=false"), ist.json()) ~> route ~> check {
        (responseAs[JsObject] \ "trace") shouldBe empty
      }
    }

    "generates valid trace with vars" in withDomain(settingsWithFeatures(BF.SmartAccounts, BF.BlockV5, BF.SynchronousCalls, BF.Ride4DApps)) { d =>
      val sender     = testWallet.generateNewAccount().get
      val aliasOwner = testWallet.generateNewAccount().get
      val recipient  = testWallet.generateNewAccount().get

      val lease = LeaseTransaction.selfSigned(2.toByte, sender, recipient.toAddress, 50.waves, 0.001.waves, ntpTime.getTimestamp()).explicitGet()

      d.appendBlock(
        GenesisTransaction.create(sender.toAddress, 1000.waves, ntpTime.getTimestamp()).explicitGet(),
        GenesisTransaction.create(aliasOwner.toAddress, 1000.waves, ntpTime.getTimestamp()).explicitGet(),
        CreateAliasTransaction.selfSigned(2.toByte, aliasOwner, "test_alias", 0.001.waves, ntpTime.getTimestamp()).explicitGet(),
        SetScriptTransaction
          .selfSigned(
            2.toByte,
            sender,
            Some(TestCompiler(V5).compileContract(s"""{-# STDLIB_VERSION 5 #-}
             |{-# CONTENT_TYPE DAPP #-}
             |{-# SCRIPT_TYPE ACCOUNT #-}
             |
             |@Callable(i)
             |func default() = {
             |  let leaseToAddress = Lease(Address(base58'${recipient.toAddress}'), ${10.waves})
             |  let leaseToAlias = Lease(Alias("test_alias"), ${20.waves})
             |  strict leaseId = leaseToAddress.calculateLeaseId()
             |
             |  [
             |    leaseToAddress,
             |    leaseToAlias,
             |    LeaseCancel(base58'${lease.id()}')
             |  ]
             |}
             |""".stripMargin)),
            0.01.waves,
            ntpTime.getTimestamp()
          )
          .explicitGet(),
        lease
      )

      val invoke = InvokeScriptTransaction
        .selfSigned(2.toByte, sender, sender.toAddress, None, Seq.empty, 0.005.waves, Asset.Waves, ntpTime.getTimestamp())
        .explicitGet()

      Post(routePath("/broadcast?trace=true"), invoke.json()) ~> mkRoute(d) ~> check {
        val dappTrace = (responseAs[JsObject] \ "trace").as[Seq[JsObject]].head

        (dappTrace \ "error").get shouldEqual JsNull
        (dappTrace \ "vars" \\ "name").map(_.as[String]) should contain theSameElementsAs Seq("leaseToAddress", "leaseToAlias", "leaseId")
      }
    }
  }

  routePath("/merkleProof") - {
    val transactionsGen = for {
      txsSize <- Gen.choose(1, 10)
      txs     <- Gen.listOfN(txsSize, randomTransactionGen)
    } yield txs

    val invalidBlockGen = for {
      txs     <- transactionsGen
      signer  <- accountGen
      version <- Gen.choose(Block.GenesisBlockVersion, Block.RewardBlockVersion)
      block   <- versionedBlockGen(txs, signer, version)
    } yield block

    val invalidBlocksGen =
      for {
        blockchainHeight <- Gen.choose(1, 10)
        blocks           <- Gen.listOfN(blockchainHeight, invalidBlockGen)
      } yield blocks

    val merkleProofs = for {
      index        <- Gen.choose(0, 50)
      tx           <- randomTransactionGen
      proofsLength <- Gen.choose(1, 5)
      proofBytes   <- Gen.listOfN(proofsLength, bytes32gen)
    } yield (tx, TransactionProof(tx.id(), index, proofBytes))

    def validateSuccess(expectedProofs: Seq[TransactionProof], response: HttpResponse): Unit = {
      response.status shouldBe StatusCodes.OK

      val proofs = responseAs[List[JsObject]]

      proofs.size shouldBe expectedProofs.size

      proofs.zip(expectedProofs).foreach {
        case (p, e) =>
          val transactionId    = (p \ "id").as[String]
          val transactionIndex = (p \ "transactionIndex").as[Int]
          val digests          = (p \ "merkleProof").as[List[String]].map(s => ByteStr.decodeBase58(s).get)

          transactionId shouldEqual e.id.toString
          transactionIndex shouldEqual e.transactionIndex
          digests shouldEqual e.digests.map(ByteStr(_))
      }
    }

    def validateFailure(response: HttpResponse): Unit = {
      response.status shouldEqual StatusCodes.BadRequest
      (responseAs[JsObject] \ "message").as[String] shouldEqual s"transactions do not exist or block version < ${Block.ProtoBlockVersion}"
    }

    "returns merkle proofs" in {
      forAll(Gen.choose(10, 20).flatMap(n => Gen.listOfN(n, merkleProofs))) { transactionsAndProofs =>
        val (transactions, proofs) = transactionsAndProofs.unzip
        (addressTransactions.transactionProofs _).expects(transactions.map(_.id())).returning(proofs).twice()

        val queryParams = transactions.map(t => s"id=${t.id()}").mkString("?", "&", "")
        val requestBody = Json.obj("ids" -> transactions.map(_.id().toString))

        Get(routePath(s"/merkleProof$queryParams")) ~> route ~> check {
          validateSuccess(proofs, response)
        }

        Post(routePath("/merkleProof"), requestBody) ~> route ~> check {
          validateSuccess(proofs, response)
        }
      }
    }

    "returns error in case of all transactions are filtered" in {
      forAll(invalidBlocksGen) { blocks =>
        val txIdsToBlock = blocks.flatMap(b => b.transactionData.map(tx => (tx.id().toString, b))).toMap

        val queryParams = txIdsToBlock.keySet.map(id => s"id=$id").mkString("?", "&", "")
        val requestBody = Json.obj("ids" -> txIdsToBlock.keySet)

        (addressTransactions.transactionProofs _).expects(*).returning(Nil).anyNumberOfTimes()

        Get(routePath(s"/merkleProof$queryParams")) ~> route ~> check {
          validateFailure(response)
        }

        Post(routePath("/merkleProof"), requestBody) ~> route ~> check {
          validateFailure(response)
        }
      }
    }

    "handles invalid signatures" in {
      val invalidIdsGen = for {
        ids       <- Gen.nonEmptyListOf(randomTransactionGen.map(_.id().toString))
        invalidId <- Gen.nonEmptyListOf(invalidBase58Gen)
      } yield Random.shuffle(ids ++ invalidId)

      forAll(invalidIdsGen) { invalidIds =>
        val queryParams = invalidIds.map(id => s"id=$id").mkString("?", "&", "")
        val requestBody = Json.obj("ids" -> invalidIds)

        Get(routePath(s"/merkleProof$queryParams")) ~> route should produce(InvalidSignature)

        Post(routePath("/merkleProof"), requestBody) ~> route should produce(InvalidSignature)
      }
    }
  }
}
